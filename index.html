<!--removeIf(production)-->
<html>

<head>
    <!--endRemoveIf(production)-->
    <link rel='stylesheet' href='http://www.intl.zju.edu.cn/sites/default/files/leaders-calendar/fullcalendar.css' />
    <style>
        .fc-content>span {
            white-space: normal;
        }
    </style>
    <script src='http://www.intl.zju.edu.cn/sites/default/files/leaders-calendar/jquery-3.2.1.min.js'></script>
    <script src='http://www.intl.zju.edu.cn/sites/default/files/leaders-calendar/moment.min.js'></script>
    <script src='http://www.intl.zju.edu.cn/sites/default/files/leaders-calendar/ical.js'></script>
    <script src='http://www.intl.zju.edu.cn/sites/default/files/leaders-calendar/fullcalendar.js'></script>
    <script>
        var calendarMap = {
            "xxz": "http://www.intl.zju.edu.cn/leaders/calendar?url=/owa/calendar/c3c4a18c669c4bac927a3316f4694913@intl.zju.edu.cn/b8616d3b733e45379400d2bc55fbb17217783638834842080893/calendar.ics",
            "jxq": "http://www.intl.zju.edu.cn/leaders/calendar?url=/owa/calendar/175fb9a7cf9a40149626f3da57d74932@intl.zju.edu.cn/0db0490d0108473ba5a4650342822bed11907729283955896675/calendar.ics",
            "fq": "http://www.intl.zju.edu.cn/leaders/calendar?url=/owa/calendar/f308d387084d49609812a2dfdff172f6@intl.zju.edu.cn/5477415b858b47c686cff55b937ddf7d411988937472865734/calendar.ics",
            "zgy": "http://www.intl.zju.edu.cn/leaders/calendar?url=/owa/calendar/da3d29f102a54147b00f6c8438f9efe5@intl.zju.edu.cn/e64e6468f10345ce9a2b05d7d370b5f614452814443659292241/calendar.ics"
        };

        $(document).ready(function () {
            var calendarCtrl = $('#calendar');
            calendarCtrl.fullCalendar({});
            $(document).on("change", "#leaderSelect", function (event) {
                var leaderSelect = $(this);
                var calendarUrl = calendarMap[leaderSelect.val()];
                $.get(calendarUrl)
                    .then(function (data) {
                        // parse the ics data
                        var jcalData = ICAL.parse(data.trim());
                        var comp = new ICAL.Component(jcalData);
                        var eventComps = comp.getAllSubcomponents("vevent");
                        // console.log(JSON.stringify(eventComps));
                        // map them to FullCalendar events
                        var events = $.map(eventComps, function (item) {
                            if (item.getFirstPropertyValue("class") == "PRIVATE") {
                                return null;
                            }
                            else {
                                return {
                                    "title": item.getFirstPropertyValue("summary") + ";",
                                    "start": item.getFirstPropertyValue("dtstart").toJSDate(),
                                    "end": item.getFirstPropertyValue("dtend").toJSDate(),
                                    "location": item.getFirstPropertyValue("location"),
                                    "allDay": item.getFirstPropertyValue("x-microsoft-cdo-alldayevent") == "TRUE"
                                };
                            }
                        });

                        // refresh the control
                        calendarCtrl.fullCalendar('destroy');
                        calendarCtrl.fullCalendar({
                            events: events,
                            timeFormat: "H:mm",
                            displayEventEnd: true,
                            eventRender: function (event, element) {
                                // append location
                                if (event.location != null && event.location != "") {
                                    // element.append("<span>" + event.location + "</span>");
                                    element.append("<td class='fc-widget-content'>" + event.location + "</td>");
                                }
                                else {
                                    element.append("<td class='fc-widget-content'></td>");
                                }
                            },
                            viewRender: function (view, element) {
                                // console.log(view);
                                if (view.type == "listDay") {
                                    $(".fc-widget-header", element).attr("colspan", 4);
                                }
                            },
                            header: {
                                left: 'title',
                                center: '',
                                right: 'today,month,basicWeek,listDay prev,next'
                            }
                        });

                    });
            });
        });
    </script>
    <!--removeIf(production)-->
</head>

<body>
    <!--endRemoveIf(production)-->
    <span>请选择领导干部</span>
    <select id="leaderSelect">
        <option value="" disabled selected style="display: none;">请选择领导</option>
        <option value="fq">傅强</option>
        <option value="zgy">诸葛洋</option>
        <option value="xxz">徐晓忠</option>
        <option value="jxq">江肖强</option>
    </select>
    <br />
    <br />
    <div id='calendar'></div>
</body>
<!--removeIf(production)-->

</html>
<!--endRemoveIf(production)-->