<!--removeIf(production)-->
<html>

<head>
    <!--endRemoveIf(production)-->
    <link rel='stylesheet' href='http://www.intl.zju.edu.cn/sites/default/files/leaders-calendar/fullcalendar.css' />
    <link rel='stylesheet' href='http://www.intl.zju.edu.cn/sites/default/files/leaders-calendar/jquery.loading.min.css' />

    <style>
        .fc-content>span {
            white-space: normal;
        }
    </style>
    <script src='http://www.intl.zju.edu.cn/sites/default/files/leaders-calendar/jquery-3.2.1.min.js'></script>
    <script src='http://www.intl.zju.edu.cn/sites/default/files/leaders-calendar/moment.min.js'></script>
    <script src='http://www.intl.zju.edu.cn/sites/default/files/leaders-calendar/ical.js'></script>
    <script src='http://www.intl.zju.edu.cn/sites/default/files/leaders-calendar/fullcalendar.js'></script>
    <script src='http://www.intl.zju.edu.cn/sites/default/files/leaders-calendar/jquery.loading.min.js'></script>

    <script>
        var calendarMap = {
            "lep": "http://www.intl.zju.edu.cn/leaders/calendar?url=/owa/calendar/26424075447a472b94fdeca22e4f18d2@intl.zju.edu.cn/719a733171234fc384e19288496ed9616847145918121997726/calendar.ics",
            "qp": "http://www.intl.zju.edu.cn/leaders/calendar?url=/owa/calendar/e016d57ef8f84f5dbfa588c72b40ea92@intl.zju.edu.cn/40f37155e3c94d42a66a13d29139e0f87685053842683252987/calendar.ics",
            "oyhw": "http://www.intl.zju.edu.cn/leaders/calendar?url=/owa/calendar/f4cd9cc928c44636821941d999a6b30c@intl.zju.edu.cn/bb7d72d2514846f3b49f8ab2ee64049917035343206563489241/calendar.ics",
            "qhd": "http://www.intl.zju.edu.cn/leaders/calendar?url=/owa/calendar/05e0b8b61727488d90a2c3fee4299b69@intl.zju.edu.cn/b6b99fd6f6574524a223043e71ccbfb46069825988531780237/calendar.ics",
            "dgz": "http://www.intl.zju.edu.cn/leaders/calendar?url=/owa/calendar/51d05e70b76f4fd490fe7b279cb34afd@intl.zju.edu.cn/2a9f28e5e0014be0b8f329053208785d5792558600952997080/calendar.ics",
            "xyd": "http://www.intl.zju.edu.cn/leaders/calendar?url=/owa/calendar/67c730748be14d82b770f453e96a47a9@intl.zju.edu.cn/084354d22a7c4bdcb617da347026c18c14040689527724275114/calendar.ics",
            "zjq": "http://www.intl.zju.edu.cn/leaders/calendar?url=/owa/calendar/4359bdb5df07417d9ed5fd725b80b20b@intl.zju.edu.cn/e602d7cf519e4851aaae1f26e394161414167668368471210829/calendar.ics",
            "wyf": "http://www.intl.zju.edu.cn/leaders/calendar?url=/owa/calendar/0e65ddfe6337406da34bbe0b10a49564@intl.zju.edu.cn/fc1d41a4eb3d428aaf1e797305c50ed311403698855546196815/calendar.ics",
            "hlz": "http://www.intl.zju.edu.cn/leaders/calendar?url=/owa/calendar/95588c038b214c7bbb9f6ff2b02fd8a6@intl.zju.edu.cn/1d2ce27fda8744ad9f5ae3a6314ba126336310685513748526/calendar.ics",
            "qlj": "http://www.intl.zju.edu.cn/leaders/calendar?url=/owa/calendar/acf8b619466d4414ad86f2b40f0db450@intl.zju.edu.cn/f2b1e967cf3f464282627487202e6c2916585174860441754305/calendar.ics",
            "xxz": "http://www.intl.zju.edu.cn/leaders/calendar?url=/owa/calendar/c3c4a18c669c4bac927a3316f4694913@intl.zju.edu.cn/b8616d3b733e45379400d2bc55fbb17217783638834842080893/calendar.ics",
            "jxq": "http://www.intl.zju.edu.cn/leaders/calendar?url=/owa/calendar/175fb9a7cf9a40149626f3da57d74932@intl.zju.edu.cn/0db0490d0108473ba5a4650342822bed11907729283955896675/calendar.ics",
            "fq": "http://www.intl.zju.edu.cn/leaders/calendar?url=/owa/calendar/f308d387084d49609812a2dfdff172f6@intl.zju.edu.cn/5477415b858b47c686cff55b937ddf7d411988937472865734/calendar.ics",
            "zgy": "http://www.intl.zju.edu.cn/leaders/calendar?url=/owa/calendar/da3d29f102a54147b00f6c8438f9efe5@intl.zju.edu.cn/e64e6468f10345ce9a2b05d7d370b5f614452814443659292241/calendar.ics"
        };

        $(document).ready(function () {
            var calendarCtrl = $('#calendar');
            calendarCtrl.fullCalendar({});

            $(document).on("change", "#leaderSelect", function (event) {
                var leaderSelect = $(this);
                var calendarUrl = calendarMap[leaderSelect.val()];
                calendarCtrl.loading("start");
                $.get(calendarUrl)
                    .then(function (data) {
                        calendarCtrl.loading("stop");
                        // parse the ics data
                        var jcalData = ICAL.parse(data.trim());
                        var comp = new ICAL.Component(jcalData);
                        var eventComps = comp.getAllSubcomponents("vevent");
                        // console.log(JSON.stringify(eventComps));
                        // map them to FullCalendar events
                        var events = $.map(eventComps, function (item) {
                            if (item.getFirstPropertyValue("class") == "PRIVATE") {
                                return null;
                            }
                            else {
                                return {
                                    "title": item.getFirstPropertyValue("summary") + ";",
                                    "start": item.getFirstPropertyValue("dtstart").toJSDate(),
                                    "end": item.getFirstPropertyValue("dtend").toJSDate(),
                                    "location": item.getFirstPropertyValue("location"),
                                    "allDay": item.getFirstPropertyValue("x-microsoft-cdo-alldayevent") == "TRUE"
                                };
                            }
                        });

                        // refresh the control
                        calendarCtrl.fullCalendar('destroy');
                        calendarCtrl.fullCalendar({
                            events: events,
                            height: "auto",
                            timeFormat: "H:mm",
                            displayEventEnd: true,
                            eventRender: function (event, element) {
                                // append location
                                if (event.location != null && event.location != "") {
                                    // element.append("<span>" + event.location + "</span>");
                                    element.append("<td class='fc-widget-content'>" + event.location + "</td>");
                                }
                                else {
                                    element.append("<td class='fc-widget-content'></td>");
                                }
                            },
                            viewRender: function (view, element) {
                                // console.log(view);
                                if (view.type == "listDay") {
                                    $(".fc-widget-header", element).attr("colspan", 4);
                                }
                            },
                            header: {
                                left: 'title',
                                center: '',
                                right: 'today,month,basicWeek,listDay prev,next'
                            }
                        });

                    });
            });
        });
    </script>
    <!--removeIf(production)-->
</head>

<body>
    <!--endRemoveIf(production)-->
    <span>请选择领导干部</span>
    <select id="leaderSelect">
        <option value="" disabled selected style="display: none;">请选择领导</option>
        <option value="hlz">何莲珍</option>
        <option value="fq">傅强</option>
        <option value="dgz">丁冠中</option>
        <option value="oyhw">欧阳宏伟</option>
        <option value="zgy">诸葛洋</option>
        <option value="zjq">周金其</option> 
        <option value="wyf">王玉芬</option>
        <option value="xxz">徐晓忠</option>
        <option value="qp">邱萍</option>
        <option value="qlj">屈利娟</option>
        <option value="jxq">江肖强</option>
        <option value="xyd">许亚丹</option>
        <option value="lep">李尔平</option>
        <option value="qhd">瞿海东</option>
    </select>
    <br />
    <br />
    <div id='calendar'></div>
<!--removeIf(production)-->
</body>
</html>
<!--endRemoveIf(production)-->